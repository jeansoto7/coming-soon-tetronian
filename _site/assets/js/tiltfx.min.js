!function(W){"use strict";for(var t,n=0,e="webkit moz ms o".split(" "),s=W.requestAnimationFrame,i=W.cancelAnimationFrame,o=0;o<e.length&&(!s||!i);o++)t=e[o],s=s||W[t+"RequestAnimationFrame"],i=i||W[t+"CancelAnimationFrame"]||W[t+"CancelRequestAnimationFrame"];function a(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function r(t,e){t&&(this.el=t,this.options=a({},this.options),a(this.options,e),this._init(),this._initEvents())}s&&i||(s=function(t,e){var i=(new Date).getTime(),o=Math.max(0,16-(i-n)),s=W.setTimeout(function(){t(i+o)},o);return n=i+o,s},i=function(t){W.clearTimeout(t)}),r.prototype.options={extraImgs:2,extraImgsScaleGrade:0,opacity:.7,customImgsOpacity:!1,bgfixed:!0,resetOnLeave:!0,movement:{perspective:1e3,translateX:-10,translateY:-10,translateZ:20,rotateX:2,rotateY:2,rotateZ:0},element:{mouseMoveWatcher:null,viewWatcher:null}},r.prototype._init=function(){this.tiltWrapper=document.createElement("div"),this.tiltWrapper.className="tilt",this.tiltImgBack=document.createElement("div"),this.tiltImgBack.className="tilt__back",this.tiltImgBack.tiltFxType="back",this.tiltImgBack.style.backgroundImage="url("+this.el.src+")",this.tiltWrapper.appendChild(this.tiltImgBack),this.options.extraImgs<1?this.imgCount=0:64<this.options.extraImgs?this.imgCount=64:this.imgCount=this.options.extraImgs,this.options.movement.perspective||(this.options.movement.perspective=0),this.imgElems=[];var t=this.imgCount;this.options.customImgsOpacity;this.options.bgfixed||(this.imgElems.push(this.tiltImgBack),++this.imgCount);for(var e=0;e<t;++e){var i=document.createElement("div");i.className="tilt__front",i.style.backgroundImage="url("+this.el.src+")",this.tiltWrapper.appendChild(i),this.imgElems.push(i)}this._initSetImagesOpacity(),this.el.parentNode.insertBefore(this.tiltWrapper,this.el),this.el.parentNode.removeChild(this.el),this._setViewWatcher(this),this._setMouseMoveWatcher(this),this._calcView(this)},r.prototype._initSetImagesOpacity=function(){if(this.options.customImgsOpacity)for(var t=0,e=this.imgElems.length;t<e;++t){var i=this.options.customImgsOpacity[t]?this.options.customImgsOpacity[t]:this.options.opacity;this.imgElems[t].style.opacity=i}else for(t=0,e=this.imgElems.length;t<e;++t)"back"!==this.imgElems[t].tiltFxType&&(this.imgElems[t].style.opacity=this.options.opacity)},r.prototype._calcView=function(t){t.view={width:t.viewWatcher.offsetWidth,height:t.viewWatcher.offsetHeight}},r.prototype._setMouseMoveWatcher=function(t){var e=!1;if(t.options.element&&t.options.element.mouseMoveWatcher){var i=document.querySelector(t.options.element.mouseMoveWatcher);t.mouseMoveWatcher=i,e=!0}e||(t.mouseMoveWatcher=t.viewWatcher)},r.prototype._setViewWatcher=function(t){var e=!1;if(t.options.element&&t.options.element.viewWatcher){var i=document.querySelector(t.options.element.viewWatcher);i&&(t.viewWatcher=i,e=!0)}e||(t.viewWatcher=t.tiltWrapper)},r.prototype._initEvents=function(){var e,i,o,y=this,w=y.options.movement;y.mouseMoveWatcher.addEventListener("mousemove",function(f){s(function(){for(var t=function(t){var e=0,i=0;t||(t=W.event);return t.pageX||t.pageY?(e=t.pageX,i=t.pageY):(t.clientX||t.clientY)&&(e=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:e,y:i}}(f),e=document.body.scrollLeft+document.documentElement.scrollLeft,i=document.body.scrollTop+document.documentElement.scrollTop,o=y.tiltWrapper.getBoundingClientRect(),s=t.x-o.left-e,n=t.y-o.top-i,a=0,r=y.imgElems.length;a<r;++a){var m=y.imgElems[a],c=w.rotateX?(a+1)*w.rotateX/y.imgCount*2/y.view.height*n-(a+1)*w.rotateX/y.imgCount:0,l=w.rotateY?(a+1)*w.rotateY/y.imgCount*2/y.view.width*s-(a+1)*w.rotateY/y.imgCount:0,p=w.rotateZ?(a+1)*w.rotateZ/y.imgCount*2/y.view.width*s-(a+1)*w.rotateZ/y.imgCount:0,h=w.translateX?(a+1)*w.translateX/y.imgCount*2/y.view.width*s-(a+1)*w.translateX/y.imgCount:0,u=w.translateY?(a+1)*w.translateY/y.imgCount*2/y.view.height*n-(a+1)*w.translateY/y.imgCount:0,g=w.translateZ?(a+1)*w.translateZ/y.imgCount*2/y.view.height*n-(a+1)*w.translateZ/y.imgCount:0,d=1+y.options.extraImgsScaleGrade*(r-(a+1)),v=1!==d?" scale("+d+", "+d+")":"";m.style.WebkitTransform="perspective("+w.perspective+"px) translate3d("+h+"px,"+u+"px,"+g+"px) rotate3d(1,0,0,"+c+"deg) rotate3d(0,1,0,"+l+"deg) rotate3d(0,0,1,"+p+"deg)"+v,m.style.transform="perspective("+w.perspective+"px) translate3d("+h+"px,"+u+"px,"+g+"px) rotate3d(1,0,0,"+c+"deg) rotate3d(0,1,0,"+l+"deg) rotate3d(0,0,1,"+p+"deg)"+v}})}),y.options.resetOnLeave&&y.mouseMoveWatcher.addEventListener("mouseleave",function(){setTimeout(function(){for(var t=0,e=y.imgElems.length;t<e;++t){var i=y.imgElems[t];i.style.WebkitTransform="perspective("+w.perspective+"px) translate3d(0,0,0) rotate3d(1,1,1,0deg)",i.style.transform="perspective("+w.perspective+"px) translate3d(0,0,0) rotate3d(1,1,1,0deg)"}},60)}),W.addEventListener("resize",(e=function(){y._calcView(y)},i=50,o=!0,function(t){o&&(o=!1,setTimeout(function(){o=!0},i),e(t))}))},r.prototype.init=function(){[].slice.call(document.querySelectorAll("img.tilt-effect")).forEach(function(t){new r(t,JSON.parse(t.getAttribute("data-tilt-options")))})},(new r).init(),W.TiltFx=r}(window);